- name: install containerd.io
  become: yes
  ansible.builtin.apt:
    state: present
    pkg:
      - docker-ce
      - docker-ce-cli
      - containerd.io
      - docker-compose-plugin
    update_cache: yes
  environment:
    DEBIAN_FRONTEND: noninteractive

- name: deploy default containerd config
  become: yes
  ansible.builtin.shell: mkdir -p /etc/containerd && containerd config default > /etc/containerd/config.toml

- name: set systemd cgroup in containerd config
  become: yes
  ansible.builtin.shell: sudo sed -i 's/SystemdCgroup = false/SystemdCgroup = true/' /etc/containerd/config.toml
